---
// Order Status Timeline Component
interface Props {
  currentStatus: string;
  showLabels?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

const { currentStatus, showLabels = true, size = 'md' } = Astro.props;

const statuses = [
  { key: 'ingresado', label: 'Ingresado', icon: 'inbox' },
  { key: 'en_diagnostico', label: 'Diagnóstico', icon: 'search' },
  { key: 'en_reparacion', label: 'Reparación', icon: 'build' },
  { key: 'finalizado', label: 'Finalizado', icon: 'check_circle' },
  { key: 'facturado', label: 'Facturado', icon: 'receipt' },
  { key: 'entregado', label: 'Entregado', icon: 'local_shipping' },
];

const currentIndex = statuses.findIndex(s => s.key === currentStatus);

const sizeClasses = {
  sm: { circle: 'w-6 h-6', icon: 'text-xs', line: 'h-0.5', text: 'text-xs' },
  md: { circle: 'w-8 h-8', icon: 'text-sm', line: 'h-1', text: 'text-xs' },
  lg: { circle: 'w-10 h-10', icon: 'text-base', line: 'h-1', text: 'text-sm' },
};

const sizes = sizeClasses[size];
---

<div class="w-full">
  <div class="flex items-center justify-between">
    {statuses.map((status, index) => {
      const isPast = index < currentIndex;
      const isCurrent = index === currentIndex;
      const isFuture = index > currentIndex;
      
      return (
        <div class="flex flex-col items-center flex-1 relative">
          {/* Connector Line */}
          {index > 0 && (
            <div class:list={[
              "absolute top-4 right-1/2 w-full -translate-y-1/2",
              sizes.line,
              isPast || isCurrent ? "bg-primary-500" : "bg-gray-200 dark:bg-gray-700"
            ]} style="left: -50%;" />
          )}
          
          {/* Status Circle */}
          <div class:list={[
            "relative z-10 rounded-full flex items-center justify-center transition-all duration-300",
            sizes.circle,
            isPast && "bg-primary-500 text-white",
            isCurrent && "bg-primary-500 text-white ring-4 ring-primary-100 dark:ring-primary-900",
            isFuture && "bg-gray-200 dark:bg-gray-700 text-gray-400 dark:text-gray-500"
          ]}>
            {isPast ? (
              <span class:list={["material-symbols-outlined", sizes.icon]}>check</span>
            ) : (
              <span class:list={["material-symbols-outlined", sizes.icon]}>{status.icon}</span>
            )}
          </div>
          
          {/* Label */}
          {showLabels && (
            <span class:list={[
              "mt-2 text-center font-medium transition-colors",
              sizes.text,
              isPast && "text-primary-600 dark:text-primary-400",
              isCurrent && "text-primary-700 dark:text-primary-300",
              isFuture && "text-gray-400 dark:text-gray-500"
            ]}>
              {status.label}
            </span>
          )}
        </div>
      );
    })}
  </div>
</div>
